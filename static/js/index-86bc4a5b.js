import{_ as e,r as a,o as l,a as t,c as s,d as n,g as r,t as o,b as i,l as u,f as c,e as d,w as m,i as p,D as f,C as v,F as b,q as g,j as w,u as _,n as h,h as y,v as q,G as T,E as k,x,H as R}from"./index-e507caa2.js";import{F as V}from"./FullLoading-9a58366b.js";import{u as U}from"./request-7cdedb54.js";import{F as j}from"./file-1da79ba0.js";import{V as C}from"./ValidateText-543439cc.js";import{d as A}from"./useDate-3485ccb1.js";import"./useValidate-1451d16f.js";const P={class:"ce-title-lg"},F={class:"mt-3 mb-8"},S={class:"flex"},N={class:"flex"},I=e({__name:"index",setup(e){const f=a(""),v=a("");return l((()=>{f.value=U().getReqrInfo.name,v.value=U().getPgrInfo.name})),(e,a)=>{const l=t("el-input"),b=t("el-col"),g=t("el-row"),w=t("el-form-item");return s(),n("div",null,[r("span",P,o(i(u)("Core team member")),1),r("div",F,[c(" Requester name "),d(w,{label:i(u)("Requester name")},{default:m((()=>[d(g,{class:"form-row-width"},{default:m((()=>[d(b,{span:12},{default:m((()=>[r("span",S,[d(l,{modelValue:i(f),"onUpdate:modelValue":a[0]||(a[0]=e=>p(f)?f.value=e:null),disabled:""},null,8,["modelValue"])])])),_:1})])),_:1})])),_:1},8,["label"]),c(" IT name "),d(w,{label:i(u)("IT name")},{default:m((()=>[d(g,{class:"form-row-width"},{default:m((()=>[d(b,{span:12},{default:m((()=>[r("span",N,[d(l,{modelValue:i(v),"onUpdate:modelValue":a[1]||(a[1]=e=>p(v)?v.value=e:null),disabled:""},null,8,["modelValue"])])])),_:1})])),_:1})])),_:1},8,["label"])])])}}},[["__file","C:/Program Files/Workspace/reqm-vue3/src/views/review-new/components/coreTeam/index.vue"]]),O={class:"ce-title-lg"},D={class:"mt-3 mb-8"},W={key:0},B={key:0,class:"ce-gray-color-italic"},L=["href","download"],E={class:"inline-flex"},G={key:0},H=["src"],M=e({__name:"index",setup(e){const p=U(),_=f().params.reqNo,h={reqName:{label:"Request name",type:"textarea",rows:"1"},stage:{label:"Stage"},customer:{label:"Customer"},device:{label:"Device"},tester:{label:"Tester"},equipment:{label:"Equipment"},system:{label:"System"},purpose:{label:"Purpose",type:"textarea",rows:"3"},plant:{label:"Plant"}},y="https://34.226.170.80:7777/uploads/attached_files/",q=["jpg","jpeg","gif","png","svg"],T=a({}),k=v((()=>{var e;return null==(e=p.getScope.attachedFiles)?void 0:e.map((e=>{const a=e.originalName.split(".").slice(-1)[0];return{...e,ext:a}}))}));return l((async()=>{const{reqName:e}=p.getBasicInfo,a=p.getScope;for await(const l of Object.keys(h))T.value[l]="reqName"===l?e:a[l]})),(e,a)=>{const l=t("el-input"),p=t("el-col"),f=t("el-row"),v=t("el-form-item");return s(),n("div",null,[r("span",O,o(i(u)("Request table")),1),r("div",D,[(s(),n(b,null,g(h,((e,a)=>d(v,{key:a,label:i(u)(e.label)},{default:m((()=>[d(f,{class:"form-row-width"},{default:m((()=>[d(p,{span:12},{default:m((()=>[d(l,{modelValue:i(T)[a],"onUpdate:modelValue":e=>i(T)[a]=e,type:e.type,rows:e.rows,disabled:""},null,8,["modelValue","onUpdate:modelValue","type","rows"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["label"]))),64)),c(" 上傳附件 "),d(v,{label:i(u)("Attached files")},{default:m((()=>[i(k)?(s(),n("span",W,[i(k).length?c("v-if",!0):(s(),n("span",B,o(i(u)("There is no file attached")),1)),(s(!0),n(b,null,g(i(k),((e,a)=>(s(),n("div",{key:a,class:"attachedFiles-container"},[r("a",{class:"ce-link",href:y+e.fileName,download:i(_)+"_attachment_"+e.originalName,target:"_blank"},[r("div",E,[d(i(j),{class:"mr-1"}),w(" "+o(e.originalName),1)]),-1!==q.indexOf(e.ext.toLowerCase())?(s(),n("div",G,[r("img",{src:`${y}/${e.fileName}`},null,8,H)])):c("v-if",!0)],8,L)])))),128))])):c("v-if",!0)])),_:1},8,["label"])])])}}},[["__scopeId","data-v-567c67a2"],["__file","C:/Program Files/Workspace/reqm-vue3/src/views/review-new/components/reqTable/index.vue"]]),$={class:"mt-3"},z=e({__name:"TypeRadios",emits:["get-need-refresh"],setup(e,{emit:o}){const f=_(),v=o,b=a("Project");l((()=>g(b.value)));const g=e=>{f.setRequestType(e),v("get-need-refresh",!0)};return(e,a)=>{const l=t("el-radio"),o=t("el-radio-group"),f=t("el-form-item");return s(),n("div",null,[c(" radio of type "),r("div",$,[d(f,{label:i(u)("Request type")},{default:m((()=>[d(o,{modelValue:i(b),"onUpdate:modelValue":a[0]||(a[0]=e=>p(b)?b.value=e:null),onChange:a[1]||(a[1]=e=>g(i(b)))},{default:m((()=>[d(l,{label:"Project"}),d(l,{label:"OneTime"})])),_:1},8,["modelValue"])])),_:1},8,["label"])])])}}},[["__file","C:/Program Files/Workspace/reqm-vue3/src/views/review-new/components/schedule/components/TypeRadios.vue"]]),J=e({__name:"ScheduleTable",props:{refreshCode:{type:Number,default:0}},setup(e){const r=e,o=_(),c=a(""),p=a({}),f=a({turnOnDate:"",UAT1:"",UAT2:"",release:"",monitor:""});l((async()=>{await v(),q()})),h(r,(async(e,a)=>{await v(),q()}));const v=async()=>{c.value=o.getRequestType,p.value={turnOnDate:{label:"Start coding date"},UAT1:{label:"IT buyoff (UAT1)"},UAT2:{label:"User buyoff (UAT2)"}},"Project"===c.value&&(p.value.release={label:"Release"},p.value.monitor={label:"Monitor 1 lot"})},w=async e=>{for await(const[a,l]of Object.entries(f.value))f.value[a]=A(l);q()},q=()=>{const{turnOnDate:e,UAT1:a,UAT2:l,release:t,monitor:s}=f.value;"OneTime"===c.value?o.setSchedule({turnOnDate:e,UAT1:a,UAT2:l,release:"",monitor:""}):o.setSchedule({turnOnDate:e,UAT1:a,UAT2:l,release:t,monitor:s})};return(e,a)=>{const l=t("el-date-picker"),r=t("el-col"),o=t("el-row"),c=t("el-form-item");return s(),n("div",null,[(s(!0),n(b,null,g(i(p),((e,a)=>(s(),y(c,{key:a,label:e.label},{default:m((()=>[d(o,{class:"form-row-width"},{default:m((()=>[d(r,{span:12},{default:m((()=>[d(l,{modelValue:i(f)[a],"onUpdate:modelValue":e=>i(f)[a]=e,type:"date",placeholder:i(u)("Pick a date"),onChange:w},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1024),d(r,{span:12},{default:m((()=>[d(i(C),{"key-outer":"schedule","key-inner":a},null,8,["key-inner"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["label"])))),128))])}}},[["__file","C:/Program Files/Workspace/reqm-vue3/src/views/review-new/components/schedule/components/ScheduleTable.vue"]]),K={class:"ce-title-lg"},Q={class:"mb-8"},X=e({__name:"index",setup(e){const l=a(0),t=e=>{e&&l.value++};return(e,a)=>(s(),n("div",null,[r("span",K,o(i(u)("Fill the schedule")),1),d(z,{onGetNeedRefresh:t}),r("div",Q,[d(J,{"refresh-code":i(l)},null,8,["refresh-code"])])]))}},[["__file","C:/Program Files/Workspace/reqm-vue3/src/views/review-new/components/schedule/index.vue"]]),Y={class:"submit-container"},Z=e({__name:"SubmitButton",setup(e){const l=f().params.reqNo,r=_(),c=q(),p=a(!1),v=e=>{T.prompt(u("Please leave a reason for rejection or sending back this request"),"Warning",{confirmButtonText:u("Submit"),cancelButtonText:u("Cancel"),dangerouslyUseHTMLString:!0,inputValidator:a=>{const l="Please fill in this field";switch(!0){case"Returned"===e:return!0;case"string"==typeof a&&""===a.trim():case"string"!=typeof a:return u(l);default:return!0}}}).then((async({value:a})=>await g(e,null==a?void 0:a.trim()))).catch((()=>k.info(u("Action cancelled"))))},b=async()=>{await r.checkEmpty(!0),await r.checkIllegalDate();const e=r.getValidate;let a=!1;for await(const[l,t]of Object.entries(e.schedule))if(a=""===t,""!==t)return;a&&await g("Approved")},g=async(e,a)=>{p.value=!0;const t=x.service({lock:!0,text:u("Loading"),background:"rgba(168, 171, 178, 0.3)"});setTimeout((async()=>{await r.reviewApplication(l,e,a)?(k.success(u("Review a request successfully")),c.replace({path:"/tables"})):(k.error(u("Failed to review a request")),c.push({path:"/reload"})),t.close(),p.value=!1}),2e3)};return(e,a)=>{const l=t("el-button");return s(),n("div",Y,[d(l,{type:"danger",loading:i(p),onClick:a[0]||(a[0]=e=>v("Rejected"))},{default:m((()=>[w(o(i(u)("Reject")),1)])),_:1},8,["loading"]),d(l,{type:"warning",loading:i(p),onClick:a[1]||(a[1]=e=>v("Returned"))},{default:m((()=>[w(o(i(u)("Return")),1)])),_:1},8,["loading"]),d(l,{type:"success",loading:i(p),onClick:b},{default:m((()=>[w(o(i(u)("Approve")),1)])),_:1},8,["loading"])])}}},[["__scopeId","data-v-32f79399"],["__file","C:/Program Files/Workspace/reqm-vue3/src/views/review-new/components/SubmitButton.vue"]]),ee={id:"addnew-container",class:"ce-main-container"},ae={key:0},le=e({__name:"index",setup(e){const r=q(),o=U(),u=f().params.reqNo,p=a(!1);return l((async()=>{p.value=!0,o.setReqNo(u),await o.getReqInfo();const e="Reviewing"===o.getReqStatus,a=R().userId,l=o.getPgrInfo.id===a,t=!(!e||!l);p.value=!1,t||r.push({path:"/401",replace:!0})})),(e,a)=>{const l=t("el-form");return s(),n("div",ee,[d(i(V),{loading:i(p)},null,8,["loading"]),i(p)?c("v-if",!0):(s(),n("div",ae,[d(l,{"label-width":"150px"},{default:m((()=>[c(" Core team members "),d(i(I)),c(" Request table "),d(i(M)),c(" Type & schedule "),d(i(X))])),_:1}),c(" Submit button "),d(i(Z))]))])}}},[["__file","C:/Program Files/Workspace/reqm-vue3/src/views/review-new/index.vue"]]);export{le as default};
