import{_ as e,r as t,O as l,n as a,a as r,c as o,d as s,g as i,t as n,b as u,l as c,e as d,w as f,F as p,q as v,i as m,h as b,E as g,o as h,T as w,f as y,j as T,U as x,V as A}from"./index-e507caa2.js";import{S as _}from"./search-80813722.js";import{L as k}from"./loading-967d10a4.js";import{E as C,e as q,F as R}from"./FileSaver.min-6b45f2cb.js";import{a as F}from"./useDate-3485ccb1.js";const D={id:"select-menu",class:"mr-4"},S={class:"mr-2"},E=e({__name:"SelectStatus",emits:["get-children"],setup(e,{emit:g}){const h=g,w=t("Weekly"),y=l([{value:"Weekly",label:"Weekly"},{value:"Reviewing",label:"Reviewing"},{value:"Rejected",label:"Rejected"},{value:"Proceeding",label:"Proceeding"},{value:"Cancel",label:"Cancel"},{value:"Done",label:"Done"}]);return a(w,(e=>h("get-children",w.value))),(e,t)=>{const l=r("el-option"),a=r("el-select");return o(),s("span",D,[i("strong",S,n(u(c)("Switch status"))+":",1),d(a,{modelValue:u(w),"onUpdate:modelValue":t[0]||(t[0]=e=>m(w)?w.value=e:null),placeholder:u(c)("Please select")},{default:f((()=>[(o(!0),s(p,null,v(u(y),(e=>(o(),b(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])}}},[["__scopeId","data-v-48124a2c"],["__file","C:/Program Files/Workspace/reqm-vue3/src/views/control-table/components/SelectStatus.vue"]]),U={id:"keyword-search-container",class:"mr-4"},I={class:"mr-2"},O=e({__name:"SearchBar",props:{loading:{type:Boolean,require:!0,default:()=>!1},isReset:{type:Boolean,require:!0,default:()=>!1}},emits:["get-children"],setup(e,{emit:l}){const f=l,p=e,v=t(""),b=t(["reqNo","reqName","type","plant","reqr","pgr","approveDate","issueDate","status","buyoffStatus","turnOn","UAT1Exp","UAT1Act","UAT2Exp","UAT2Act","releaseExp","releaseAct","monitorExp","monitorAct"]),g=e=>{f("get-children",{keywords:e,searchFields:b.value})};return a(p,(()=>{p.isReset&&(v.value="")})),(e,t)=>{const l=r("el-input");return o(),s("span",U,[i("strong",I,n(`${u(c)("Search")}:`),1),d(l,{modelValue:u(v),"onUpdate:modelValue":t[0]||(t[0]=e=>m(v)?v.value=e:null),placeholder:p.loading?`${u(c)("Now loading")}...`:`${u(c)("Keyword search")}...`,disabled:p.loading,"prefix-icon":p.loading?u(k):u(_),onInput:g},null,8,["modelValue","placeholder","disabled","prefix-icon"])])}}},[["__scopeId","data-v-4b44659d"],["__file","C:/Program Files/Workspace/reqm-vue3/src/views/control-table/components/SearchBar.vue"]]),j=e({__name:"ExportXlsx",props:{resource:{type:Object,require:!0,default:()=>({})},title:{type:String,require:!0,default:()=>"Weekly"}},setup(e){const l=e,r=F(),s=t(`ReqM_${r}_weekly control table`),i=t("Control table"),n=t([]),d=t([]),f=t([]),p=t([["ReqNo","Request name","Status","Approve date","Review duration (day)","Lead time (day)","Rescheduling (times)","","Type","Plant","Requester","IT","Issue date","Turn on","IT buyoff (UAT1)","","User buyoff (UAT2)","","Release","","Monitor 1 lot",""],["","","","","","","IT","Requester","","","","","","","Expect","Actual","Expect","Actual","Expect","Actual","Expect","Actual"]]);a(l,(async()=>{l.resource&&(n.value=Object.assign([],l.resource),d.value=await(async e=>{const t=[];return e.forEach((e=>{let{reqNo:l,reqName:a,buyoffStatus:r,approveDate:o,reviewDuration:s,leadTime:i,rescheduleIT:n,rescheduleReqr:u,type:c,plant:d,reqr:f,pgr:p,issueDate:v,turnOnDate:m,UAT1Exp:b,UAT1Act:g,UAT2Exp:h,UAT2Act:w,releaseExp:y,releaseAct:T,monitorExp:x,monitorAct:A}=e;i=i<0?"NA":i,c=c||"NA",t.push([l,a,r,o,s,i,n,u,c,d,f,p,v,m,b,g,h,w,y,T,x,A])})),t})(n.value),f.value=await(async e=>{let t=[];for await(const l of e){let e=[];if("Proceeding"===l.status)switch(!0){case l.UAT1IsDue:e.push(2,3,15);break;case l.UAT2IsDue:e.push(2,3,17);break;case l.releaseIsDue:e.push(2,3,19);break;case l.monitorIsDue:e.push(2,3,21)}t.push(e)}return t})(n.value)),l.title&&(s.value=`ReqM_${r}_${l.title.toLowerCase()} control table`,i.value=`${l.title} table`)}));const v=async()=>{try{const e=new q.exports.Workbook;await(async(e,t,l,a,r)=>{const o=e.addWorksheet(t),s=l[0].length,i=l.length,n=["",11,51,17,13,15,12,11,11,10,8,15,15,12,9,10,10,10,10,9,9,9,9],u={bold:!0,size:10,name:"Arial"},c={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFFF00"}},d={size:10,name:"Arial"},p={size:10,name:"Arial",color:{argb:"FFFF0000"}},v={size:10,name:"Arial",color:{argb:"FF0000FF"}},m={type:"pattern",pattern:"solid",fgColor:{argb:"FFBFBFBF"}},b={vertical:"middle",horizontal:"center",wrapText:!0},g={vertical:"middle",horizontal:"left",wrapText:!0},h={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}};for(let f=0;f<r.length+i;f++)f<i?o.addRow(l[f]):o.addRow(r[f-i]);["A","B","C","D","E","F","I","J","K","L","M","N"].map((e=>`${e}1:${e}2`)).concat(["G1:H1","O1:P1","Q1:R1","S1:T1","U1:V1"]).forEach((e=>o.mergeCells(e)));for(let w=1;w<=o.rowCount;w++){let e=o.getRow(w);for(let t=1;t<=s;t++)if(o.getColumn(t).width=n[t],e.getCell(t).alignment=2===t?w<=i?b:g:b,e.getCell(t).border=h,w<=i)e.getCell(t).fill=c,e.getCell(t).font=u;else{const l=e.getCell(3).value,r=a[w-i-1];switch(l){case"Done":e.getCell(t).fill=m,e.getCell(t).font=r.doneOnToday?v:d;break;case"Cancel":e.getCell(t).fill=m,e.getCell(t).font=r.cancelOnToday?p:d;break;case"Rejected":e.getCell(t).fill=m,e.getCell(t).font=r.rejectedOnToday?p:d;break;default:{const l=Object.assign(f.value[w-i-1]);switch(r.newOnToday){case!0:l.length&&l.includes(t)?e.getCell(t).font=p:e.getCell(t).font=v;break;case!1:l.length&&l.includes(t)?e.getCell(t).font=p:e.getCell(t).font=d}}}}}})(e,i.value,p.value,n.value,d.value);const t=await e.xlsx.writeBuffer();return g.success(c("Export successfully")),R(new Blob([t]),s.value+".xlsx")}catch(e){console.error(e),g.error(c("Failed to export"))}};return(e,t)=>(o(),b(u(C),{"on-export":v}))}},[["__file","C:/Program Files/Workspace/reqm-vue3/src/views/control-table/components/ExportXlsx.vue"]]),N={class:"ce-main-container"},P={class:"ce-toolbar ml-0 mr-0"},$={id:"table-container"},W=["href"],B={key:0,class:"ce-italic"},V={key:1,class:"ce-italic"},z={key:0,class:"ce-gray-color-italic"},L={key:1},M={key:0,class:"ce-gray-color-italic"},G={key:1},H={key:0},K={key:1,class:"ce-gray-color-italic"},X={class:"ce-blue-color ce-text-bold"},J=e({__name:"index",setup(e){const m=t(null),g=t([]),_=t([]),k=t(!1),C=t(!1),q=t(0),R=t("Weekly"),F=l({field:"reqNo",order:"desc"}),D=[{title:"IT buyoff (UAT1)",prefix:"UAT1"},{title:"User buyoff (UAT2)",prefix:"UAT2"},{title:"Release",prefix:"release"},{title:"Monitor 1 lot",prefix:"monitor"}],S=({row:e})=>{if(e.newOnToday)return"ce-blue-color";if(e.thisWeek){if("Done"===e.status)return e.doneOnToday?"row-closed ce-blue-color":"row-closed";if("Cancel"===e.status)return e.cancelOnToday?"row-closed ce-red-color":"row-closed";if("Rejected"===e.status)return e.rejectedOnToday?"row-closed ce-red-color":"row-closed"}else if("Done"===e.status||"Cancel"===e.status||"Rejected"===e.status)return"row-closed";if("Proceeding"===e.status){const t=e.buyoffStatus.split(" ")[1];if(e[`${t}IsDue`])return"row-delay"}return""},U=[{label:"Project",value:"Project"},{label:"OneTime",value:"OneTime"},{label:"Undefined",value:void 0}],I=[{label:"P1",value:"P1"},{label:"P2",value:"P2"},{label:"P3",value:"P3"}];let J=t([]);const Q=()=>{const e=m.value.getTableData().visibleData;q.value=e.length},Y=({value:e,row:t,column:l})=>t[l.field]===e,Z=()=>{C.value=!0,k.value=!0,setTimeout((()=>{x(R.value).then((e=>{g.value=e.data,_.value=e.data,q.value=null==e?void 0:e.data.length,m.value&&(m.value.reloadData(g.value),m.value.sort("reqNo","desc")),C.value=!1,k.value=!1}))}),1e3)},ee=e=>R.value=e;h((async()=>{Z(),await w("IT").then((e=>{const{data:t}=e;if(J.value=[],t&&t.length){const e=t.map((e=>{const{nameEn:t}=e;return{label:t,value:t}}));J.value=e}}))})),a(R,(()=>Z()));const te=e=>{const t=A.toValueString(e.keywords).trim().toLowerCase(),l=Object.assign([],e.searchFields);if(m.value.clearFilter(),t){const e=g.value.filter((e=>l.some((l=>A.toValueString(e[l]).toLowerCase().indexOf(t)>-1))));_.value=e.map((e=>Object.assign({},e)))}else _.value=g.value;q.value=_.value.length};return(e,t)=>{const l=r("vxe-column"),a=r("vxe-colgroup"),h=r("vxe-table");return o(),s("div",N,[y(" Toolbar "),i("div",P,[i("span",null,[d(u(E),{onGetChildren:ee}),d(u(O),{"is-reset":u(C),loading:u(k),onGetChildren:te},null,8,["is-reset","loading"])]),i("span",null,[d(u(j),{resource:u(g),title:u(R)},null,8,["resource","title"])])]),y(" Table "),i("div",$,[d(h,{ref_key:"tableRef",ref:m,border:"",align:"center",size:"mini",height:"100%","auto-resize":"",loading:u(k),data:u(_),"empty-render":{name:"NoData"},"show-header-overflow":"","show-overflow":"","tooltip-config":{showAll:!0},"row-class-name":S,"row-config":{isHover:!0},"column-config":{resizable:!0},"sort-config":{defaultSort:u(F)},onFilterChange:Q},{default:f((()=>[d(l,{field:"reqNo",title:u(c)("ReqNo"),width:"90",sortable:"",fixed:"left"},{default:f((({row:e})=>[i("a",{class:"ce-link",href:`#/detail/${e.reqNo}`,target:"_blank"},n(e.reqNo),9,W)])),_:1},8,["title"]),d(l,{field:"reqName",title:u(c)("Request name"),width:"350",sortable:"","header-align":"center",align:"left",fixed:"left"},null,8,["title"]),d(l,{field:"buyoffStatus",title:u(c)("Status"),width:"116",fixed:"left"},{default:f((({row:e})=>["Done"===e.buyoffStatus||"Cancel"===e.buyoffStatus?(o(),s("span",B,n(e.buyoffStatus),1)):(o(),s("span",V,n(e.buyoffStatus),1))])),_:1},8,["title"]),d(l,{field:"approveDate",title:u(c)("Review date"),width:"115",sortable:""},{default:f((({row:e})=>[""===e.approveDate?(o(),s("span",z,"N/A")):(o(),s("span",L,n(e.approveDate),1))])),_:1},8,["title"]),d(l,{field:"reviewDuration",title:`${u(c)("Review duration (day)")}`,width:"100",sortable:""},null,8,["title"]),d(l,{field:"leadTime",title:`${u(c)("Lead time (day)")}`,width:"110",sortable:""},{default:f((({row:e})=>[e.leadTime<0?(o(),s("span",M,"N/A")):(o(),s("span",G,n(e.leadTime),1))])),_:1},8,["title"]),d(a,{title:`${u(c)("Rescheduling (times)")}`},{default:f((()=>[d(l,{field:"rescheduleIT",title:"IT",width:"79",sortable:""}),d(l,{field:"rescheduleReqr",title:u(c)("Requester"),width:"99",sortable:""},null,8,["title"])])),_:1},8,["title"]),d(l,{field:"type",title:u(c)("Type"),width:"85",sortable:"",filters:U,"filter-method":Y},{default:f((({row:e})=>[e.type?(o(),s("span",H,n(e.type),1)):(o(),s("span",K,"N/A"))])),_:1},8,["title"]),d(l,{field:"plant",title:u(c)("Plant"),width:"87",sortable:"",filters:I,"filter-method":Y},null,8,["title"]),d(l,{field:"reqr",title:u(c)("Requester"),"min-width":"100",sortable:""},{default:f((({row:e})=>[T(n(e.reqr),1)])),_:1},8,["title"]),u(J).length?(o(),b(l,{key:0,field:"pgr",title:"IT",width:"100",sortable:"",filters:u(J),"filter-method":Y},null,8,["filters"])):y("v-if",!0),d(l,{field:"issueDate",title:u(c)("Issue date"),width:"99",sortable:""},null,8,["title"]),d(l,{field:"turnOnDate",title:"Turn on",width:"66"}),(o(),s(p,null,v(D,((e,t)=>d(a,{key:t,title:e.title},{default:f((()=>[d(l,{field:`${e.prefix}Exp`,title:u(c)("Expect"),width:"71"},null,8,["field","title"]),d(l,{field:`${e.prefix}Act`,title:u(c)("Actual"),width:"71"},null,8,["field","title"])])),_:2},1032,["title"]))),64))])),_:1},8,["loading","data","sort-config"])]),y(" Search result "),i("span",null,[T(n(u(c)("Total"))+" ",1),i("span",X,n(u(q)),1),T(" "+n(u(q)>1?u(c)("records"):u(c)("record")),1)])])}}},[["__scopeId","data-v-4482d437"],["__file","C:/Program Files/Workspace/reqm-vue3/src/views/control-table/index.vue"]]);export{J as default};
