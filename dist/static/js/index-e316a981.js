import{_ as e,u as a,C as l,a as t,c as s,d as r,e as o,b as n,i,r as c,f as u,g as d,t as m,l as p,w as f,h as v,j as b,m as _,E as w,o as h,n as g,q as y,F as q,D as T,G as k,p as x,k as P,v as F,x as R,H as C}from"./index-286476da.js";import{F as N}from"./FullLoading-191839ce.js";import{V}from"./ValidateText-9b727844.js";import{S as j,r as S,u as U}from"./xlsx-61eb777a.js";import{F as W}from"./file-be3fcb2d.js";import{U as A}from"./UploadFiles-90a46623.js";import"./search-1c068f01.js";import"./loading-b4b972c1.js";const I={class:"flex"},B=e({__name:"ReqrName",setup(e){const c=a(),u=l((()=>c.application.coreTeam.reqr.name));return(e,a)=>{const l=t("el-input");return s(),r("span",I,[o(l,{modelValue:n(u),"onUpdate:modelValue":a[0]||(a[0]=e=>i(u)?u.value=e:null),disabled:""},null,8,["modelValue"])])}}},[["__file","C:/Program Files/Workspace/reqm-vue3/src/views/edit-new/components/coreTeam/components/ReqrName.vue"]]),E={class:"flex"},z=e({__name:"PgrName",setup(e){const d=l((()=>a().application.coreTeam.pgr.name)),m=c({}),p=e=>{m.value=e,d.value=e.name,a().setPgr(m.value)};return(e,a)=>{const l=t("el-input");return s(),r("span",E,[u(" 顯示 Programmer name 框 "),o(l,{modelValue:n(d),"onUpdate:modelValue":a[0]||(a[0]=e=>i(d)?d.value=e:null),disabled:""},null,8,["modelValue"]),u(" 選擇 Programmer button 與搜尋對話框 "),o(n(j),{dept:"IT",onGetUserInfo:p})])}}},[["__scopeId","data-v-79b2d2e2"],["__file","C:/Program Files/Workspace/reqm-vue3/src/views/edit-new/components/coreTeam/components/PgrName.vue"]]),G={class:"ce-title-lg"},D={class:"mt-3 mb-8"},H=e({__name:"index",setup:e=>(e,a)=>{const l=t("el-col"),i=t("el-row"),c=t("el-form-item");return s(),r("div",null,[d("span",G,m(n(p)("Define core team member")),1),d("div",D,[u(" Requester name "),o(c,{label:n(p)("Requester name")},{default:f((()=>[o(i,{class:"form-row-width"},{default:f((()=>[o(l,{span:12},{default:f((()=>[o(B)])),_:1})])),_:1})])),_:1},8,["label"]),u(" IT name "),o(c,{label:n(p)("IT name")},{default:f((()=>[o(i,{class:"form-row-width"},{default:f((()=>[o(l,{span:12},{default:f((()=>[o(z)])),_:1}),o(l,{span:12},{default:f((()=>[o(n(V),{"key-outer":"coreTeam","key-inner":"pgr"})])),_:1})])),_:1})])),_:1},8,["label"])])])}},[["__file","C:/Program Files/Workspace/reqm-vue3/src/views/edit-new/components/coreTeam/index.vue"]]),L={href:"/application/template.xlsx",class:"ce-link",download:"it-req-template"},M=d("br",null,null,-1),O=e({__name:"Notice",setup:e=>(e,a)=>{const l=t("el-alert");return s(),v(l,{type:"info",title:n(p)("How to fill out this form?"),"show-icon":"",closable:!1},{default:f((()=>[b(m(n(p)("You can download"))+" ",1),d("a",L,m(n(p)("template file")),1),b(" "+m(n(p)(", then upload it after you complete it")),1),M,b(" "+m(n(p)("Without uploading the template, you can complete these fields then submit it")),1)])),_:1},8,["title"])}},[["__file","C:/Program Files/Workspace/reqm-vue3/src/views/edit-new/components/reqTable/components/Notice.vue"]]),Y=e({__name:"PrintReqTable",emits:["get-need-refresh"],setup(e,{emit:l}){const r=c(null),i=a(),u=l,d=e=>{r.value.clearFiles(),e.raw=null,i.setReqTable({reqName:"",stage:"",customer:"",device:"",tester:"",equipment:"",system:"",purpose:""}),u("get-need-refresh",!0)},h=(e,a)=>{r.value.clearFiles();const l=e[0];l.uid=_(),r.value.handleStart(l)},g=e=>{if(!e.raw)return;let a=e.raw,l=new FileReader;l.onloadend=a=>{let t=l.result,s=S(t,{type:"array"}),r=s.SheetNames,o=s.Sheets[r];U.sheet_to_json(o);for(let l=2;l<=9;l++)if(void 0===o[U.encode_cell({r:l,c:3})])return w.error(p("You have not completed the request table yet")),void d(e);i.setReqTable({reqName:o[U.encode_cell({r:2,c:3})].v,stage:o[U.encode_cell({r:3,c:3})].v,customer:o[U.encode_cell({r:4,c:3})].v,device:o[U.encode_cell({r:5,c:3})].v,tester:o[U.encode_cell({r:6,c:3})].v,equipment:o[U.encode_cell({r:7,c:3})].v,system:o[U.encode_cell({r:8,c:3})].v,purpose:o[U.encode_cell({r:9,c:3})].v}),u("get-need-refresh",!0)},l.readAsArrayBuffer(a)};return(e,a)=>{const l=t("el-button"),i=t("el-upload"),c=t("el-form-item");return s(),v(c,{label:n(p)("Upload excel"),class:"block"},{default:f((()=>[o(i,{ref_key:"uploadRef",ref:r,limit:1,"on-remove":d,"auto-upload":!1,"on-exceed":h,"on-change":g,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"},{trigger:f((()=>[o(l,{type:"primary",plain:""},{default:f((()=>[b(m(`${n(p)("Select file")}...`),1)])),_:1})])),_:1},512)])),_:1},8,["label"])}}},[["__scopeId","data-v-7c6db4b2"],["__file","C:/Program Files/Workspace/reqm-vue3/src/views/edit-new/components/reqTable/components/PrintReqTable.vue"]]),$=e({__name:"ManualReqTable",props:{refreshCode:{type:Number,default:0}},setup(e){const l=a(),i=c({}),u=e,d={reqName:{label:"Request name",type:"textarea",rows:"1"},stage:{label:"Stage"},customer:{label:"Customer"},device:{label:"Device"},tester:{label:"Tester"},equipment:{label:"Equipment"},system:{label:"System"},purpose:{label:"Purpose",type:"textarea",rows:"5"}},m=e=>l.setReqTable(i.value);return h((()=>i.value=l.getReqTable)),g(u,(e=>i.value=l.getReqTable)),(e,a)=>{const l=t("el-input"),c=t("el-col"),u=t("el-row"),v=t("el-form-item");return s(),r(q,null,y(d,((e,a)=>o(v,{key:a,label:n(p)(e.label)},{default:f((()=>[o(u,{class:"form-row-width"},{default:f((()=>[o(c,{span:12},{default:f((()=>[o(l,{modelValue:n(i)[a],"onUpdate:modelValue":e=>n(i)[a]=e,type:e.type,rows:e.rows,onChange:m},null,8,["modelValue","onUpdate:modelValue","type","rows"])])),_:2},1024),o(c,{span:12},{default:f((()=>[o(n(V),{"key-outer":"reqTable","key-inner":a},null,8,["key-inner"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["label"]))),64)}}},[["__file","C:/Program Files/Workspace/reqm-vue3/src/views/edit-new/components/reqTable/components/ManualReqTable.vue"]]),K=e({__name:"PlantRadios",setup(e){const l=a(),r=c("");return h((()=>r.value=l.getPlant)),g(r,(e=>l.setPlant(r.value))),(e,a)=>{const l=t("el-radio"),c=t("el-radio-group"),u=t("el-col"),d=t("el-row"),m=t("el-form-item");return s(),v(m,{label:n(p)("Plant")},{default:f((()=>[o(d,{class:"form-row-width"},{default:f((()=>[o(u,{span:12},{default:f((()=>[o(c,{modelValue:n(r),"onUpdate:modelValue":a[0]||(a[0]=e=>i(r)?r.value=e:null)},{default:f((()=>[o(l,{label:"P1",size:"small",class:"pl-2"},{default:f((()=>[b("P1")])),_:1}),o(l,{label:"P2",size:"small"},{default:f((()=>[b("P2")])),_:1}),o(l,{label:"P3",size:"small"},{default:f((()=>[b("P3")])),_:1})])),_:1},8,["modelValue"])])),_:1}),o(u,{span:12},{default:f((()=>[o(n(V),{"key-outer":"reqTable","key-inner":"plant"})])),_:1})])),_:1})])),_:1},8,["label"])}}},[["__file","C:/Program Files/Workspace/reqm-vue3/src/views/edit-new/components/reqTable/components/PlantRadios.vue"]]),J={class:"ce-title-lg"},Q={class:"p-3"},X={class:"mt-3 mb-8"},Z={style:{width:"100%",margin:"8px"}},ee={style:{"margin-bottom":"8px"}},ae=(e=>(x("data-v-19d82b58"),e=e(),P(),e))((()=>d("br",null,null,-1))),le={key:0,class:"ce-gray-color-italic attachedFiles-container"},te=["href","download"],se={class:"inline-flex"},re=e({__name:"index",setup(e){const l=a(),i=c(0),_=T().params.reqNo,g=c([]),x=e=>{e&&i.value++},P=async e=>{l.setAttachedFiles(e)},F=c(!1),R=()=>{k.confirm(p("Are you sure to upload attached file again?"),"Warning",{confirmButtonText:p("OK"),cancelButtonText:p("Cancel"),type:"warning",dangerouslyUseHTMLString:!0}).then((()=>F.value=!0)).catch((()=>w.info(p("Action cancelled"))))};return h((()=>{g.value=l.getAttachedFiles,l.setAttachedFiles(g.value)})),(e,a)=>{const l=t("el-button"),c=t("el-form-item");return s(),r("div",null,[d("span",J,m(n(p)("Fill the request table")),1),u(" 提示 alert "),d("div",Q,[o(n(O))]),u(" 填 Request table 可以有兩種方式:  "),d("div",X,[u(" 1. 讀 .xlsx 檔填表 "),o(n(Y),{onGetNeedRefresh:x}),u(" 2. 手動輸入各項欄位 "),o(n($),{"refresh-code":n(i)},null,8,["refresh-code"]),u(" 再來選擇此需求是哪個廠 "),o(n(K)),u(" 上傳附件 "),o(c,{label:n(p)("Attached files")},{default:f((()=>[d("span",Z,[d("span",ee,m(n(p)("Uploaded files")),1),ae,n(g).length?u("v-if",!0):(s(),r("div",le,m(n(p)("There is no file attached")),1)),(s(!0),r(q,null,y(n(g),((e,a)=>(s(),r("div",{key:a,class:"attachedFiles-container"},[d("a",{class:"ce-link",href:"https://34.226.170.80:7777/uploads/attached_files/"+e.fileName,download:n(_)+"_attachment_"+e.originalName,target:"_blank"},[d("div",se,[o(n(W),{class:"mr-1"}),b(" "+m(e.originalName),1)])],8,te)])))),128)),n(F)?u("v-if",!0):(s(),v(l,{key:1,disabled:n(F),plain:"",type:"primary",style:{"margin-bottom":"12px"},onClick:R},{default:f((()=>[b(m(n(p)("Upload again")),1)])),_:1},8,["disabled"]))]),n(F)?(s(),v(n(A),{key:0,size:"small",plain:true,onGetChildren:P})):u("v-if",!0)])),_:1},8,["label"])])])}}},[["__scopeId","data-v-19d82b58"],["__file","C:/Program Files/Workspace/reqm-vue3/src/views/edit-new/components/reqTable/index.vue"]]),oe={class:"edit-new-submit-container"},ne=e({__name:"SubmitButton",setup(e){const l=a(),i=T().params.reqNo,u=F(),d=c(!1),v=async()=>{await l.checkEmpty(!1),await _()},_=async()=>{const e=await l.getValidate;let a=!1;for await(const[t,s]of Object.entries(e))for await(const[e,r]of Object.entries(s)){const t=l.getBenefitType;if(l.getRequestType,a=""===r,""!==r){switch(e){case"pgr":window.scrollTo({top:0,behavior:"smooth"});break;case"reqName":case"stage":case"customer":{const e="Efficiency"===t?510:560;window.scrollTo({top:e,behavior:"smooth"});break}case"device":case"tester":case"equipment":case"system":case"purpose":case"plant":{const e="Efficiency"===t?840:880;window.scrollTo({top:e,behavior:"smooth"});break}}return}}a&&await h()},h=async()=>{d.value=!0;const e=R.service({lock:!0,text:`${p("Loading")}...`,background:"rgba(168, 171, 178, 0.3)"});setTimeout((async()=>{await l.editApplication(i)?(w.success(p("Edit a request successfully")),u.replace({path:"/tables"})):(w.error(p("Failed to edit a request")),u.push({path:"/reload"})),e.close(),d.value=!1}),2e3)};return(e,a)=>{const l=t("el-button");return s(),r("div",oe,[o(l,{type:"primary",loading:n(d),onClick:v},{default:f((()=>[b(m(n(p)("Submit")),1)])),_:1},8,["loading"])])}}},[["__scopeId","data-v-76d7ca6a"],["__file","C:/Program Files/Workspace/reqm-vue3/src/views/edit-new/components/SubmitButton.vue"]]),ie={id:"addnew-container",class:"ce-main-container"},ce={key:0},ue=e({__name:"index",setup(e){const l=F(),i=a(),d=c(!1);return h((async()=>{d.value=!0;const e=await i.fetchApplication(T().params.reqNo),a=C().userId,t=!(!(i.application.coreTeam.reqr.id===a)||!e);d.value=!1,t||l.push({path:"/401",replace:!0})})),(e,a)=>{const l=t("el-form");return s(),r("div",ie,[o(n(N),{loading:n(d)},null,8,["loading"]),n(d)?u("v-if",!0):(s(),r("div",ce,[o(l,{"label-width":"150px"},{default:f((()=>[u(" Core team members "),o(n(H)),u(" Request table "),o(n(re))])),_:1}),u(" Submit button "),o(n(ne))]))])}}},[["__file","C:/Program Files/Workspace/reqm-vue3/src/views/edit-new/index.vue"]]);export{ue as default};
